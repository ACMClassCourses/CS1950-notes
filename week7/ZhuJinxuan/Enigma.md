# 恩尼格玛密码机Enigma，与二战前对其的使用和研究
## 部件与工作原理
### 转子
转子是Enigma的核心部件。每个转子上都有26个不同的导线，当输入一个字母时，通过电流流过转子中的导线，就会输出另一个字母。  
当键盘上一个键被按下时，转子的方向就自动地转动一个字母的位置，得到新的字母替换规则；为了进一步增强安全性，Enigma使用了多个转子，当一个转子转动整整一圈以后，它上面有一个齿拨动下一个转子，使得它的方向转动一个字母的位置。这样，在三个转子的情况下，不重复的方向个数达到26 * 26 * 26=17576个。  
每个转子都具有可调节的初始位置——三个转子可能的初始位置显然也有17576个。另外，三个转子可以按特定顺序安装，这样又有3！=6种可能。
### 反射器
反射器使得Enigma加密、解密更加方便。当一个字母通过转子系统时，它会先经过转子的一系列变换，然后进入反射器。反射器会将字母映射到与之前不同的字母上。然后，信号再次通过转子系统，沿着相同的路径返回，最终输出加密或解密后的字母。  
稍微思考一下就可以发现：由于反射器的存在，Enigma可以实现加密、解密过程的一致性。将明文输入进行加密，与将密文输入进行解密，用的是同样的步骤。
### 连接板
连接板由一系列可以插拔的电缆组成，每个电缆上都有两个插头，用于连接字母对。通过调整这些插头的位置，可以建立字母之间的映射关系。  
连接板大大增加了暴力破解Enigma所需的枚举次数。仅仅支持两两交换6对字母的连接板，便提供了100391791500种可能。
### ![](img.png)
## 复杂度分析
上文提到的转子初始位置、排列顺序，与连接板字母交换情况，为Enigma提供了17576 * 6 * 100391791500种可能情况，也就是约一亿亿种的可能性。  
面对如此多的可能性，暴力破解是不可能的；而转子的独特设计，又使得Enigma成为一种复式替换系统（同一个字母可能有不同的对应方式），这使得词频分析对它无能为力。  
## 德军的使用方式
每月分发的密码本中，记有每日的daily key，包括连接板的连接、转子的顺序、转子的初始方向。 这被称为daily key。  
另一方面，每次发送电文时，操作员会首先发送一个新的密钥，更改转子的初始方向。操作员随机地选择三个字母，并为了防止出错，将其在键盘上连打两遍。（此时使用的是daily key）。接着他重新调整三个转子的初始方向为之前所选择的三个字母，然后才正式对明文加密。这被称为message key。
## 波兰密码学家Rejewski的破解方式
通过“某些途径”，波兰方面获取到了上述Enigma的工作原理与德军的使用方式。不仅如此，他们还知道了三个转子的内部布线（这玩意儿量产的，就那么几个型号，只是转位的变化）。当然知道了全部这些，破译密码还是相当困难。  
而Rejewski的思路是：注意到操作员随机选择的三个字母会在开头重复打两次——因为Enigma是复式替换，这两串字符对应的密文不会相同——而两串密文之间的关系，便为密码的破解提供了可乘之机。（你就打一次，如果不小心转子转错了，对方发现消息不对，再让你重发不就好了？）

---
### Credit & Reference
__Liang Alei__  
__codemate__  
<https://zhuanlan.zhihu.com/p/20263860>
### 下期预告 ~
__二战期间图灵对Enigma的破解__